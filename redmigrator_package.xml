<?xml version="1.0" encoding="UTF-8"?>
<!-- ================================================================== -->
<!-- redMIGRATOR packager -->
<!-- This PHING build file generates the redSHOP component package -->
<!-- To use in your environment do the following steps: -->
<!-- Change the following variables in build.properties file -->
<!-- (copy variables from build.properties.dist ) -->
<!-- - change the version in variable comp.version -->
<!-- - change the source folder path in variable repo.dir -->
<!-- - change the package folder path in variable package.dir -->
<!-- - execute this PHING build file -->
<!-- ================================================================== -->
<project name="com_redmigrator" default="dist">
	<!-- Do initialization stuff -->
	<property file="build.properties" override="true" />

	<property
			name="component"
			value="com-redMIGRATOR"
			override="true" />

	<property
			name="plugin"
			value="plg-redMIGRATOR"
			override="true" />

	<property
			name="version"
			value="${comp.version}"
			override="true" />

	<!-- Target dir where component will be created -->
	<property
			name="componentdir"
			value="${package.dir}/${component}-v${version}"
			override="true" />

	<!-- Target dir where plugin will be created -->
	<property
			name="plugindir"
			value="${www.dir}/plugins/system/redmigrator"
			override="true" />

	<!-- ============================================ -->
	<!-- Create packages folder -->
	<!-- ============================================ -->
	<target name="prepare">
		<!-- Check if the target folder exists. If not, create it -->
		<if>
			<available file="${componentdir}" type="dir" />
			<then>
				<echo msg="Removing old ${componentdir}" />
				<delete dir="${componentdir}" />
			</then>
		</if>
		<echo msg="Making directory to store the packages at ${componentdir}" />
		<mkdir dir="${componentdir}" />

	</target>

	<!-- ============================================ -->
	<!-- Target: build -->
	<!-- ============================================ -->
	<!-- Copy the source files to the target folder -->

	<target name="build" depends="prepare">

		<echo msg="Copying INSTALLER files to build directory..." />
		<copy todir="${componentdir}">
			<fileset dir="${www.dir}/">
				<include name="LICENSE.txt" />
				<include name="com_redmigrator.xml" />
				<include name="install.php" />
			</fileset>
		</copy>

		<echo msg="Copying COMPONENT folder to build directory..." />
		<copy todir="${componentdir}/component">
			<fileset dir="${www.dir}/component">
				<include name="**" />
				<exclude name=".*" />
			</fileset>
		</copy>

		<echo msg="Copying redCORE LIBRARIES folder to build directory..."/>
		<copy todir="${componentdir}/redCORE">
			<fileset dir="${www.dir}/redCORE">
				<include name="**"/>
				<exclude name=".*"/>
				<exclude name="build.*"/>
				<exclude name="*.md"/>
			</fileset>
		</copy>

	</target>

	<!-- ============================================ -->
	<!-- (DEFAULT) Target: dist -->
	<!-- ============================================ -->
	<target name="dist" depends="build">
		<echo msg="Creating ZIP archive..." />

		<zip destfile="${componentdir}/../${component}-v${version}_${comp.joomla.version}.zip">
			<fileset dir="${componentdir}">
				<include name="**" />
				<exclude name=".*" />
			</fileset>
		</zip>

		<zip destfile="${componentdir}/../${plugin}-v${version}_${plg.joomla.version}.zip">
			<fileset dir="${plugindir}">
				<include name="**" />
				<exclude name=".*" />
			</fileset>
		</zip>

		<echo msg="Files copied and compressed in build directory OK!" />
	</target>
</project>